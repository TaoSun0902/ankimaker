<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce PD1 è®¤è¯é¢˜åº“ (åŠ å¯†ç‰ˆ)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        :root { --primary: #0070d2; --bg: #f4f6f9; --hover-bg: #f0f5fc; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; }
        
        /* å®¹å™¨ */
        .container { background: white; width: 100%; max-width: 900px; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-height: 500px; }
        .hidden { display: none !important; }

        /* --- æ–°å¢ï¼šæˆæƒç™»å½•å±‚æ ·å¼ --- */
        #auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f4f6f9; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .auth-box {
            background: white; padding: 40px; border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center;
            width: 300px;
        }
        .auth-input {
            width: 100%; padding: 12px; margin: 20px 0;
            border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box;
            font-size: 16px; outline: none; transition: 0.3s;
        }
        .auth-input:focus { border-color: var(--primary); }
        /* ------------------------- */

        /* é¦–é¡µå¸ƒå±€ */
        .home-layout { text-align: center; }
        .hero-section { border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .range-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px; }
        .range-btn { background: white; border: 1px solid #d8dde6; padding: 15px; border-radius: 6px; cursor: pointer; color: #0070d2; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .range-btn:hover { border-color: var(--primary); background: var(--hover-bg); transform: translateY(-2px); }

        /* ç­”é¢˜é¡µå¤´éƒ¨ */
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: #666; font-size: 14px; }
        .question-badge { display: inline-block; background: #eef4ff; color: #0070d2; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 10px; font-weight: bold; }
        .multi-badge { background: #fff0db; color: #b97406; }

        /* é¢˜ç›®æ–‡æœ¬ */
        .question-content h3 { margin-top: 0; line-height: 1.5; color: #222; }

        /* é€‰é¡¹æ ·å¼ */
        .option-item { display: block; width: 100%; text-align: left; padding: 15px; margin: 12px 0; border: 2px solid #e9ecef; background: #f8f9fb; border-radius: 6px; cursor: pointer; transition: 0.1s; position: relative; font-family: "Segoe UI", sans-serif; }
        .option-item:hover { background: var(--hover-bg); border-color: #d8dde6; }
        .option-item.selected { border-color: var(--primary); background-color: #eef6ff; box-shadow: 0 0 0 1px var(--primary) inset; }
        .option-item.correct { background: #e6ffed; border-color: #2e844a; color: #2e844a; opacity: 1 !important; }
        .option-item.missed { border: 2px dashed #2e844a; background: #f0fff4; opacity: 0.7; }
        .option-item.wrong { background: #fdd; border-color: #c23934; color: #c23934; }
        .option-item.disabled { pointer-events: none; }

        /* åº•éƒ¨æŒ‰é’® */
        .action-btn { width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .submit-btn { background: var(--primary); color: white; }
        .submit-btn:hover { background: #005fb2; }
        .next-btn { background: #f1f3f5; color: #333; border: 1px solid #ddd; }
        .next-btn:hover { background: #e9ecef; }

        /* è§£æåŒº */
        #feedback-box { margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 6px; border-left: 5px solid #ccc; animation: fadeIn 0.3s; }
        #feedback-box.success { border-left-color: #2e844a; }
        #feedback-box.error { border-left-color: #c23934; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-box">
        <h2 style="color:var(--primary); margin-top:0;">ğŸ”’ è®¿é—®å—é™</h2>
        <p style="color:#666; font-size:14px;">è¯·è¾“å…¥æˆæƒç è®¿é—®é¢˜åº“</p>
        <input type="password" id="auth-input" class="auth-input" placeholder="è¾“å…¥å¯†ç ..." onkeyup="if(event.key==='Enter') checkAuth()">
        <button class="action-btn submit-btn" onclick="checkAuth()">è§£é”è¿›å…¥</button>
        <p id="auth-error" style="color:#c23934; font-size:13px; margin-top:10px; display:none;">âŒ æˆæƒç é”™è¯¯</p>
    </div>
</div>

<div id="main-app" class="container hidden">
    <div id="home-screen" class="home-layout">
        <div class="hero-section">
            <h1>Salesforce PD1 è®¤è¯é¢˜åº“</h1>
            <p>Total Questions: <strong id="total-count" style="color:var(--primary)">0</strong></p>
        </div>
        <div style="text-align:left; color:#555; font-weight:bold; margin-bottom:10px;">Select Range:</div>
        <div id="range-grid" class="range-grid"></div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="header-bar">
            <button onclick="goHome()" style="background:none; border:none; color:#0070d2; cursor:pointer; font-weight:bold;">â¬… Back to List</button>
            <span id="progress-info"></span>
        </div>

        <div id="quiz-body">
            <div id="question-type-badge"></div>
            <div id="question-text" class="question-content"></div>
            <div id="options-list"></div>
            <button id="submit-btn" class="action-btn submit-btn hidden" onclick="submitMultiAnswer()">Submit Answer</button>
        </div>

        <div id="feedback-box" class="hidden">
            <div id="feedback-content"></div>
            <button id="next-btn" class="action-btn next-btn" onclick="nextQuestion()">Next Question â¡</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="questions.js"></script>

<script>
    // ==========================================
    // ğŸ” 1. è®¾ç½®ä½ çš„æˆæƒç  (åœ¨è¿™é‡Œä¿®æ”¹å¯†ç )
    // ==========================================
    const SECRET_CODE = "888888"; 
    // ==========================================

    // æˆæƒé€»è¾‘
    function checkAuth() {
        const input = document.getElementById('auth-input').value;
        const errorMsg = document.getElementById('auth-error');
        
        if (input === SECRET_CODE) {
            // å¯†ç æ­£ç¡®ï¼šéšè—é®ç½©ï¼Œæ˜¾ç¤ºä¸»ç•Œé¢ï¼Œå¹¶ä¿å­˜çŠ¶æ€
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            localStorage.setItem('pd1_auth_status', 'passed'); // è®°ä½ç™»å½•çŠ¶æ€
        } else {
            errorMsg.style.display = 'block';
            document.getElementById('auth-input').value = '';
        }
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•è¿‡
    window.onload = function() {
        const authStatus = localStorage.getItem('pd1_auth_status');
        if (authStatus === 'passed') {
            // å¦‚æœä¹‹å‰ç™»å½•è¿‡ï¼Œç›´æ¥æ”¾è¡Œ
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }
        init(); // åˆå§‹åŒ–åŸæ¥çš„é¢˜åº“é€»è¾‘
    }

    // åŸæœ‰é€»è¾‘ä¿æŒä¸å˜
    const RANGE_SIZE = 50;
    const db = window.ALL_QUESTIONS || [];
    
    let currentQueue = [];
    let currentIndex = 0;
    let isMultiSelect = false;
    let currentSelections = new Set();
    let hasAnswered = false;

    const els = {
        home: document.getElementById('home-screen'),
        quiz: document.getElementById('quiz-screen'),
        grid: document.getElementById('range-grid'),
        qText: document.getElementById('question-text'),
        badge: document.getElementById('question-type-badge'),
        optsList: document.getElementById('options-list'),
        submitBtn: document.getElementById('submit-btn'),
        feedbackBox: document.getElementById('feedback-box'),
        feedbackContent: document.getElementById('feedback-content'),
        progress: document.getElementById('progress-info'),
        nextBtn: document.getElementById('next-btn')
    };

    function init() {
        document.getElementById('total-count').innerText = db.length;
        renderRangeButtons();
    }

    function renderRangeButtons() {
        if(db.length === 0) return;
        let html = '';
        for (let i = 0; i < db.length; i += RANGE_SIZE) {
            const end = Math.min(i + RANGE_SIZE, db.length);
            html += `<button class="range-btn" onclick="startQuiz(${i}, ${end})">Q ${i + 1} - ${end}</button>`;
        }
        els.grid.innerHTML = html;
    }

    function startQuiz(start, end) {
        currentQueue = db.slice(start, end);
        currentIndex = 0;
        els.home.classList.add('hidden');
        els.quiz.classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        hasAnswered = false;
        currentSelections.clear();
        els.feedbackBox.classList.add('hidden');
        els.submitBtn.classList.add('hidden');
        
        const q = currentQueue[currentIndex];
        
        isMultiSelect = q.correct.length > 1;

        els.progress.innerText = `Progress: ${currentIndex + 1} / ${currentQueue.length} (ID: #${q.id})`;
        els.badge.innerHTML = isMultiSelect 
            ? `<span class="question-badge multi-badge">Multiple Choice (Select ${q.correct.length})</span>` 
            : `<span class="question-badge">Single Choice</span>`;

        let safeTitle = q.title.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        const codeBlock = q.code ? `<pre><code class="language-java">${q.code.replace(/</g, '&lt;')}</code></pre>` : '';
        els.qText.innerHTML = `<h3>${q.id}. ${safeTitle}</h3>${codeBlock}`;

        els.optsList.innerHTML = '';
        for (let key in q.options) {
            const btn = document.createElement('div');
            btn.className = 'option-item';
            let safeOptionText = q.options[key].replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            btn.innerHTML = `<strong>${key}.</strong> ${safeOptionText}`;
            btn.dataset.opt = key;
            btn.onclick = () => handleOptionClick(key, btn);
            els.optsList.appendChild(btn);
        }

        if (isMultiSelect) {
            els.submitBtn.classList.remove('hidden');
        }

        Prism.highlightAll();
        els.nextBtn.innerText = (currentIndex === currentQueue.length - 1) ? "Finish Review ğŸ‰" : "Next Question â¡";
    }

    function handleOptionClick(key, btn) {
        if (hasAnswered) return;

        if (isMultiSelect) {
            if (currentSelections.has(key)) {
                currentSelections.delete(key);
                btn.classList.remove('selected');
            } else {
                currentSelections.add(key);
                btn.classList.add('selected');
            }
        } else {
            currentSelections.clear();
            currentSelections.add(key);
            btn.classList.add('selected'); 
            submitAnswer(); 
        }
    }

    function submitMultiAnswer() {
        if (currentSelections.size === 0) return alert("Please select an option.");
        submitAnswer();
    }

    function submitAnswer() {
        hasAnswered = true;
        const q = currentQueue[currentIndex];
        const userAns = Array.from(currentSelections).sort().join('');
        const isCorrect = (userAns === q.correct);

        els.submitBtn.classList.add('hidden');

        const allOpts = els.optsList.querySelectorAll('.option-item');
        allOpts.forEach(div => {
            div.classList.add('disabled');
            const optKey = div.dataset.opt;
            const isRightKey = q.correct.includes(optKey);
            const isSelected = currentSelections.has(optKey);

            if (isRightKey) {
                if (isSelected) {
                    div.classList.add('correct');
                } else {
                    div.classList.add('missed');
                }
            } else {
                if (isSelected) {
                    div.classList.add('wrong');
                }
            }
        });

        els.feedbackBox.className = ''; 
        els.feedbackBox.classList.add(isCorrect ? 'success' : 'error');
        
        els.feedbackContent.innerHTML = `
            <h3 style="margin:0 0 10px 0; color:${isCorrect ? '#2e844a' : '#c23934'}">
                ${isCorrect ? 'âœ… Correct!' : 'âŒ Incorrect'}
            </h3>
            <div style="font-size:14px; line-height:1.6; color:#333;">${q.explanation}</div>
        `;
        els.feedbackBox.classList.remove('hidden');
    }

    function nextQuestion() {
        if (currentIndex < currentQueue.length - 1) {
            currentIndex++;
            renderQuestion();
            window.scrollTo(0, 0);
        } else {
            alert("Set Completed! Returning to list.");
            goHome();
        }
    }

    function goHome() {
        els.quiz.classList.add('hidden');
        els.home.classList.remove('hidden');
    }
</script>
</body>
</html>