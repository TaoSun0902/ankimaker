<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce PD1 è®¤è¯é¢˜åº“</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        :root { --primary: #0070d2; --bg: #f4f6f9; --hover-bg: #f0f5fc; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; }
        
        /* å®¹å™¨ */
        .container { background: white; width: 100%; max-width: 900px; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-height: 500px; }
        .hidden { display: none !important; }

        /* é¦–é¡µå¸ƒå±€ */
        .home-layout { text-align: center; }
        .hero-section { border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .range-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px; }
        .range-btn { background: white; border: 1px solid #d8dde6; padding: 15px; border-radius: 6px; cursor: pointer; color: #0070d2; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .range-btn:hover { border-color: var(--primary); background: var(--hover-bg); transform: translateY(-2px); }

        /* ç­”é¢˜é¡µå¤´éƒ¨ */
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: #666; font-size: 14px; }
        .question-badge { display: inline-block; background: #eef4ff; color: #0070d2; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 10px; font-weight: bold; }
        .multi-badge { background: #fff0db; color: #b97406; } /* å¤šé€‰é¢˜æ ‡ç­¾é¢œè‰² */

        /* é¢˜ç›®æ–‡æœ¬ */
        .question-content h3 { margin-top: 0; line-height: 1.5; color: #222; }

        /* é€‰é¡¹æ ·å¼ */
        .option-item { display: block; width: 100%; text-align: left; padding: 15px; margin: 12px 0; border: 2px solid #e9ecef; background: #f8f9fb; border-radius: 6px; cursor: pointer; transition: 0.1s; position: relative; font-family: "Segoe UI", sans-serif; }
        .option-item:hover { background: var(--hover-bg); border-color: #d8dde6; }
        
        /* é€‰ä¸­çŠ¶æ€ (æäº¤å‰) */
        .option-item.selected { border-color: var(--primary); background-color: #eef6ff; box-shadow: 0 0 0 1px var(--primary) inset; }

        /* ç»“æœçŠ¶æ€ (æäº¤å) */
        .option-item.correct { background: #e6ffed; border-color: #2e844a; color: #2e844a; opacity: 1 !important; } /* æ­£ç¡®ä¸”é€‰ä¸­ */
        .option-item.missed { border: 2px dashed #2e844a; background: #f0fff4; opacity: 0.7; } /* æ­£ç¡®ä½†æ²¡é€‰ */
        .option-item.wrong { background: #fdd; border-color: #c23934; color: #c23934; } /* é€‰é”™äº† */
        .option-item.disabled { pointer-events: none; }

        /* åº•éƒ¨æŒ‰é’® */
        .action-btn { width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .submit-btn { background: var(--primary); color: white; }
        .submit-btn:hover { background: #005fb2; }
        .next-btn { background: #f1f3f5; color: #333; border: 1px solid #ddd; }
        .next-btn:hover { background: #e9ecef; }

        /* è§£æåŒº */
        #feedback-box { margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 6px; border-left: 5px solid #ccc; animation: fadeIn 0.3s; }
        #feedback-box.success { border-left-color: #2e844a; }
        #feedback-box.error { border-left-color: #c23934; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="home-screen" class="home-layout">
        <div class="hero-section">
            <h1>Salesforce PD1 è®¤è¯é¢˜åº“</h1>
            <p>Total Questions: <strong id="total-count" style="color:var(--primary)">0</strong></p>
        </div>
        <div style="text-align:left; color:#555; font-weight:bold; margin-bottom:10px;">Select Range:</div>
        <div id="range-grid" class="range-grid"></div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="header-bar">
            <button onclick="goHome()" style="background:none; border:none; color:#0070d2; cursor:pointer; font-weight:bold;">â¬… Back to List</button>
            <span id="progress-info"></span>
        </div>

        <div id="quiz-body">
            <div id="question-type-badge"></div>
            
            <div id="question-text" class="question-content"></div>
            
            <div id="options-list"></div>
            
            <button id="submit-btn" class="action-btn submit-btn hidden" onclick="submitMultiAnswer()">Submit Answer</button>
        </div>

        <div id="feedback-box" class="hidden">
            <div id="feedback-content"></div>
            <button id="next-btn" class="action-btn next-btn" onclick="nextQuestion()">Next Question â¡</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="questions.js"></script>

<script>
    const RANGE_SIZE = 50;
    const db = window.ALL_QUESTIONS || [];
    
    // çŠ¶æ€ç®¡ç†
    let currentQueue = [];
    let currentIndex = 0;
    let isMultiSelect = false;
    let currentSelections = new Set(); // å­˜å‚¨ç”¨æˆ·é€‰é¡¹
    let hasAnswered = false;

    // DOM å…ƒç´ å¼•ç”¨
    const els = {
        home: document.getElementById('home-screen'),
        quiz: document.getElementById('quiz-screen'),
        grid: document.getElementById('range-grid'),
        qText: document.getElementById('question-text'),
        badge: document.getElementById('question-type-badge'),
        optsList: document.getElementById('options-list'),
        submitBtn: document.getElementById('submit-btn'),
        feedbackBox: document.getElementById('feedback-box'),
        feedbackContent: document.getElementById('feedback-content'),
        progress: document.getElementById('progress-info'),
        nextBtn: document.getElementById('next-btn')
    };

    // åˆå§‹åŒ–
    function init() {
        document.getElementById('total-count').innerText = db.length;
        renderRangeButtons();
    }

    // ç”Ÿæˆç½‘æ ¼æŒ‰é’®
    function renderRangeButtons() {
        if(db.length === 0) return;
        let html = '';
        for (let i = 0; i < db.length; i += RANGE_SIZE) {
            const end = Math.min(i + RANGE_SIZE, db.length);
            html += `<button class="range-btn" onclick="startQuiz(${i}, ${end})">Q ${i + 1} - ${end}</button>`;
        }
        els.grid.innerHTML = html;
    }

    // å¼€å§‹ç»ƒä¹ 
    function startQuiz(start, end) {
        currentQueue = db.slice(start, end);
        currentIndex = 0;
        els.home.classList.add('hidden');
        els.quiz.classList.remove('hidden');
        renderQuestion();
    }

    // æ¸²æŸ“é¢˜ç›® (æ ¸å¿ƒé€»è¾‘)
    function renderQuestion() {
        // é‡ç½®
        hasAnswered = false;
        currentSelections.clear();
        els.feedbackBox.classList.add('hidden');
        els.submitBtn.classList.add('hidden');
        
        const q = currentQueue[currentIndex];
        
        // 1. åˆ¤æ–­æ˜¯å¦å¤šé€‰
        isMultiSelect = q.correct.length > 1;

        // 2. æ›´æ–°å¤´éƒ¨ä¿¡æ¯
        els.progress.innerText = `Progress: ${currentIndex + 1} / ${currentQueue.length} (ID: #${q.id})`;
        els.badge.innerHTML = isMultiSelect 
            ? `<span class="question-badge multi-badge">Multiple Choice (Select ${q.correct.length})</span>` 
            : `<span class="question-badge">Single Choice</span>`;

        // 3. æ¸²æŸ“é¢˜å¹² (âœ… ä¿®å¤ï¼šå¤„ç†æ ‡é¢˜ä¸­çš„ç‰¹æ®Šå­—ç¬¦)
        let safeTitle = q.title.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        // ä»£ç å—æœ¬èº«éœ€è¦å•ç‹¬å¤„ç† < ç¬¦å·
        const codeBlock = q.code ? `<pre><code class="language-java">${q.code.replace(/</g, '&lt;')}</code></pre>` : '';
        els.qText.innerHTML = `<h3>${q.id}. ${safeTitle}</h3>${codeBlock}`;

        // 4. æ¸²æŸ“é€‰é¡¹
        els.optsList.innerHTML = '';
        for (let key in q.options) {
            const btn = document.createElement('div');
            btn.className = 'option-item';
            
            // âœ… ä¿®å¤ï¼šå¤„ç†é€‰é¡¹ä¸­çš„ç‰¹æ®Šå­—ç¬¦ (å¦‚ List<String>)
            let safeOptionText = q.options[key].replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            btn.innerHTML = `<strong>${key}.</strong> ${safeOptionText}`;
            btn.dataset.opt = key;
            btn.onclick = () => handleOptionClick(key, btn);
            els.optsList.appendChild(btn);
        }

        // 5. æ˜¾ç¤ºæäº¤æŒ‰é’® (å¤šé€‰)
        if (isMultiSelect) {
            els.submitBtn.classList.remove('hidden');
        }

        Prism.highlightAll();
        els.nextBtn.innerText = (currentIndex === currentQueue.length - 1) ? "Finish Review ğŸ‰" : "Next Question â¡";
    }

    // ç‚¹å‡»é€‰é¡¹å¤„ç†
    function handleOptionClick(key, btn) {
        if (hasAnswered) return; // å·²ç­”é¢˜é”å®š

        if (isMultiSelect) {
            // å¤šé€‰ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€
            if (currentSelections.has(key)) {
                currentSelections.delete(key);
                btn.classList.remove('selected');
            } else {
                currentSelections.add(key);
                btn.classList.add('selected');
            }
        } else {
            // å•é€‰ï¼šç›´æ¥é€‰ä¸­å¹¶æäº¤
            currentSelections.clear();
            currentSelections.add(key);
            btn.classList.add('selected'); 
            submitAnswer(); 
        }
    }

    // å¤šé€‰æäº¤å…¥å£
    function submitMultiAnswer() {
        if (currentSelections.size === 0) return alert("Please select an option.");
        submitAnswer();
    }

    // ç»Ÿä¸€åˆ¤é¢˜é€»è¾‘
    function submitAnswer() {
        hasAnswered = true;
        const q = currentQueue[currentIndex];
        
        // ç”Ÿæˆç”¨æˆ·ç­”æ¡ˆå­—ç¬¦ä¸² (å¦‚ "BD")
        const userAns = Array.from(currentSelections).sort().join('');
        const isCorrect = (userAns === q.correct);

        els.submitBtn.classList.add('hidden');

        // æ›´æ–°é€‰é¡¹æ ·å¼
        const allOpts = els.optsList.querySelectorAll('.option-item');
        allOpts.forEach(div => {
            div.classList.add('disabled');
            const optKey = div.dataset.opt;

            const isRightKey = q.correct.includes(optKey); // æ˜¯å¦åœ¨æ­£ç¡®ç­”æ¡ˆé‡Œ
            const isSelected = currentSelections.has(optKey); // ç”¨æˆ·æ˜¯å¦é€‰äº†

            if (isRightKey) {
                if (isSelected) {
                    div.classList.add('correct'); // æ­£ç¡®ä¸”é€‰äº† (ç»¿)
                } else {
                    div.classList.add('missed'); // æ­£ç¡®æ²¡é€‰ (è™šçº¿)
                }
            } else {
                if (isSelected) {
                    div.classList.add('wrong'); // é”™è¯¯ä¸”é€‰äº† (çº¢)
                }
            }
        });

        // æ˜¾ç¤ºè§£æ
        els.feedbackBox.className = ''; 
        els.feedbackBox.classList.add(isCorrect ? 'success' : 'error');
        
        els.feedbackContent.innerHTML = `
            <h3 style="margin:0 0 10px 0; color:${isCorrect ? '#2e844a' : '#c23934'}">
                ${isCorrect ? 'âœ… Correct!' : 'âŒ Incorrect'}
            </h3>
            <div style="font-size:14px; line-height:1.6; color:#333;">${q.explanation}</div>
        `;
        els.feedbackBox.classList.remove('hidden');
    }

    function nextQuestion() {
        if (currentIndex < currentQueue.length - 1) {
            currentIndex++;
            renderQuestion();
            window.scrollTo(0, 0);
        } else {
            alert("Set Completed! Returning to list.");
            goHome();
        }
    }

    function goHome() {
        els.quiz.classList.add('hidden');
        els.home.classList.remove('hidden');
    }

    init();
</script>
</body>
</html>